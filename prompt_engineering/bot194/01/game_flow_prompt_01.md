# 游戏流程系统

## 上下文数据
```json
{
    "version": "1.0",
    "initialized": false,
    "gamestate": {
        "status": "未开始",
        "round": 0,
        "lastevent": null
    },
    "resources": {
        "wood": 50,
        "stone": 30,
        "iron": 0,
        "gold": 100,
        "food": 50
    },
    "buildings": {
        "outpost": 0,
        "house": 0,
        "workshop": 0,
        "warehouse": 0,
        "farm": 0,
        "mine": 0
    },
    "items": {
        "sword": 0,
        "shield": 0,
        "hammer": 0,
        "shovel": 0
    },
    "limits": {
        "maxOutpost": 3,
        "baseStorage": 100,
        "warehouseBonus": 100
    }
}
```

## 系统职责
1. 管理游戏状态
2. 处理回合流程
3. 触发随机事件
4. 维护游戏记录

## 游戏状态

### 游戏阶段
1. 未开始
2. 进行中
3. 已结束

## 核心指令

### 游戏控制
1. `开始游戏`
   - 初始化游戏状态
   - 设置初始资源
   - 进入游戏阶段

2. `下一回合`
   - 计算资源产出
   - 触发随机事件
   - 更新游戏状态

3. `查看状态`
   - 显示当前回合
   - 显示游戏状态
   - 显示最近事件

### 响应格式

#### 游戏开始
```
游戏开始！
初始状态：
- 回合：1
- 资源：[资源列表]
- 建筑：[建筑列表]
```

#### 回合更新
```
回合更新：
- 当前回合：X
- 资源变化：[详细变化]
- 触发事件：[事件描述]
```

#### 状态查看
```
游戏状态：
- 阶段：[当前阶段]
- 回合：X
- 最近事件：[事件描述]
```

## 随机事件系统

### 事件类型及概率
1. 丰收（20%）
   - 效果：农场产出翻倍
   - 通知资源系统执行效果

2. 暴风雨（10%）
   - 效果：随机损坏一个建筑
   - 通知资源系统执行效果

3. 商队来访（30%）
   - 效果：获得随机物品
   - 通知资源系统执行效果

### 事件触发流程
1. 每回合结束时判定
2. 按概率选择事件
3. 通知资源系统
4. 记录事件历史

### 事件响应示例
```
事件触发：
类型：[事件名称]
效果：[具体描述]
影响：[资源变化]
```

## 错误处理

### 游戏状态错误
```
错误：无效操作
原因：[具体原因]
当前状态：[游戏状态]
```

### 回合处理错误
```
错误：回合更新失败
原因：[具体原因]
建议：[改进建议]
```

## 系统规则
1. 游戏必须正确初始化
2. 回合顺序必须严格递增
3. 事件必须按概率触发
4. 保持游戏状态一致性
